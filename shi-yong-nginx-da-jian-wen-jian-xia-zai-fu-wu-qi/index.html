<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ä½¿ç”¨nginxæ­å»ºæ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨ | è¡¨é…±ç´« </title>
<link rel="shortcut icon" href="https://diss.one/favicon.ico?v=1699419513018">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://diss.one/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="ä½¿ç”¨nginxæ­å»ºæ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨ | è¡¨é…±ç´«  - Atom Feed" href="https://diss.one/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">


<script async src="https://www.googletagmanager.com/gtag/js?id=G-KL7J9YT996"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KL7J9YT996');
</script>


    <meta name="description" content="å‰è¨€ï¼šä¼°è®¡å¾ˆå¤šå–œæ¬¢æŠ˜è…¾çš„æœ‹å‹æ‰‹é‡Œéƒ½æœ‰ä¸å°‘vpså’ŒåŸŸåï¼Œåªæ˜¯å¯æƒœçš„æ˜¯ï¼Œå¥½å¤šéƒ½æ‹¿æ¥åƒç°äº†ã€‚vpsæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ä¼˜åŠ¿å°±æ˜¯ï¼šåœ°å¤„æœºæˆ¿ï¼Œç½‘ç»œå¸¦å®½è¶³ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨è¿™ç‚¹ä¸‹ï¼ˆåˆè§„ï¼‰bt/ç§å­èµ„æºï¼Œç„¶åæœåŠ¡ç«¯å®‰è£…ç›¸åº”çš„åª’ä½“æœåŠ¡å™¨æ¯”å¦‚plexï¼Œjellyf..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://diss.one">
  <img class="avatar" src="https://diss.one/images/avatar.png?v=1699419513018" alt="">
  </a>
  <h1 class="site-title">
    è¡¨é…±ç´« 
  </h1>
  <p class="site-description">
    å¤æ‚çš„ä¸–ç•Œ ä¸€ä¸ªå°±å¤Ÿäº†
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/about" class="menu">
          å…³äº
        </a>
      
    
      
        <a href="/lnks" class="menu">
          å‹é“¾
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              ä½¿ç”¨nginxæ­å»ºæ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨
            </h2>
            <div class="post-info">
              <span>
                03-13-2022
              </span>
              <span>
                4 min read
              </span>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <p>å‰è¨€ï¼šä¼°è®¡å¾ˆå¤šå–œæ¬¢æŠ˜è…¾çš„æœ‹å‹æ‰‹é‡Œéƒ½æœ‰ä¸å°‘vpså’ŒåŸŸåï¼Œåªæ˜¯å¯æƒœçš„æ˜¯ï¼Œå¥½å¤šéƒ½æ‹¿æ¥åƒç°äº†ã€‚vpsæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ä¼˜åŠ¿å°±æ˜¯ï¼šåœ°å¤„æœºæˆ¿ï¼Œç½‘ç»œå¸¦å®½è¶³ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨è¿™ç‚¹ä¸‹ï¼ˆåˆè§„ï¼‰bt/ç§å­èµ„æºï¼Œç„¶åæœåŠ¡ç«¯å®‰è£…ç›¸åº”çš„åª’ä½“æœåŠ¡å™¨æ¯”å¦‚<code>plex</code>ï¼Œ<code>jellyfin</code>æ¥ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ç”¨<code>caddy</code>æˆ–è€…<code>nginx</code>ç½‘é¡µç«¯åœ¨çº¿çœ‹ä¸‹å¥½çš„è§†é¢‘ï¼Œæ‰¯è¿œäº†......</p>
<!--more-->
<p>æœ¬æ–‡ä»‹ç»ä¸€ç§æ–¹æ³•ï¼Œè®©ä½ çš„vpsæ´¾ä¸Šç”¨åœºï¼Œä½ å¯ä»¥æ‹¿å®ƒåšæ–‡ä»¶å…±äº«ã€‚å…·ä½“å®ç°ç›®æ ‡æ˜¯ï¼šè®©ä½ å¯ä»¥é€šè¿‡è®¿é—®<code>https://example.com</code>æ¥è®¿é—®ç›¸åº”ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¯æŸ¥çœ‹å¯ä¸‹è½½ï¼Œå¹¶ä¸”ä½ å¯ä»¥ç»™è¿™ä¸ªè®¿é—®è®¾ç½®ä¸€ä¸ªè®¿é—®éªŒè¯ã€‚</p>
<p>å‡†å¤‡æ¡ä»¶ï¼š</p>
<ul>
<li>ä¸€ä¸ªåŸŸåï¼Œè¯ä¹¦å¯ä½¿ç”¨Cloudflareæä¾›çš„</li>
<li>ä¸€å°æœ‰å…¬ç½‘IPçš„VPSæœåŠ¡å™¨</li>
<li>ä¸€å°æ–¹ä¾¿æ“ä½œçš„æœ¬åœ°ç”µè„‘</li>
</ul>
<h2 id="ä¸€-è·å–etcnginxå‹ç¼©åŒ…">ä¸€ã€è·å–/etc/nginxå‹ç¼©åŒ…</h2>
<p>æ‰§è¡Œä¸‹é¢å‘½ä»¤å‰ï¼Œä½ éœ€è¦å…ˆå®‰è£…å¥½<code>docker</code>ï¼Œè¿™é‡Œä¸å†èµ˜è¿°å®‰è£…æ–¹æ³•ï¼š</p>
<pre><code># æ‹‰å–nginxé•œåƒ
docker pull nginx:stable

# å…ˆåˆ›å»ºä¸€ä¸ªnginxå®¹å™¨ï¼Œé€‰/root/nginxä¸ºæ˜ å°„ç›®å½•
docker run -d \
	--name nginx \
	--net host \
	-v /root/nginx:/root/nginx \
	nginx:stable

# è¿›å…¥å®¹å™¨ï¼Œæ‰§è¡Œæ“ä½œ
docker exec -it nginx bash

# åˆ‡æ¢åˆ°/etc/ç›®å½•ï¼Œå°†/etc/nginxæ‰“åŒ…ï¼Œå¹¶æ‹·è´åˆ°/root/nginxç›®å½•ä¸‹
cd /etc/ &amp;&amp; tar -zcf nginx.tar.gz ./nginx/ &amp;&amp; cp nginx.tar.gz /root/nginx/

#é€€å‡ºå®¹å™¨ï¼ˆå›åˆ°å®¿ä¸»æœºshellç¯å¢ƒï¼‰
exit

# ç§»é™¤å®¹å™¨
docker rm -f nginx
</code></pre>
<h2 id="äºŒ-åˆ›å»ºå¯†é’¥æ–‡æœ¬æ–‡ä»¶">äºŒã€åˆ›å»ºå¯†é’¥æ–‡æœ¬æ–‡ä»¶</h2>
<p>ä¸Šé¢ç§»é™¤å®¹å™¨åï¼Œå®¿ä¸»æœº<code>/root/nginx</code>ç›®å½•ä¸‹ä»ç„¶å­˜åœ¨<code>nginx.tar.gz</code>çš„å‹ç¼©åŒ…ï¼Œä¸‹é¢è¿›è¡Œè§£å‹ï¼Œå¹¶è¿›è¡Œä¸€ç³»åˆ—ç›¸å…³æ“ä½œï¼š</p>
<pre><code># å°†å‹ç¼©åŒ…è§£å‹åˆ°/etc/ç›®å½•ä¸‹
tar -zxf /root/nginx/nginx.tar.gz -C /etc/

# åˆ‡æ¢è·¯å¾„
cd /etc/nginx/conf.d

# åˆ©ç”¨nginxå†…ç½®çš„opensslåˆ›å»ºæ ‡å‡†å¯†æ–‡
docker run --rm nginx:stable openssl passwd -crypt password
# å‡è®¾ä¸‹é¢æ˜¯å‘½ä»¤ç»“æŸè¾“å‡ºçš„å¯†æ–‡ï¼Œé‚£ä¹ˆè¿™æ„å‘³ç€å½“ä½ ä½¿ç”¨admin:9nL8bmgcoY5HY ä½œä¸ºå¯†é’¥æ–‡æœ¬å†…å®¹æ—¶ï¼Œ
# ä½ çš„nginxç™»å½•ç”¨æˆ·åå’Œå¯†ç åˆ†åˆ«æ˜¯adminå’Œpasswordï¼Œå®é™…å¯†ç ä»¥åŠ å¯†çš„å½¢å¼å­˜åœ¨äº†æœåŠ¡ç«¯æ–‡æœ¬ä¸­
9nL8bmgcoY5HY

# åˆ›å»ºå¯†é’¥æ–‡æœ¬
echo admin:9nL8bmgcoY5HY &gt; ./httppasswd
</code></pre>
<h2 id="ä¸‰-ä¿®æ”¹defaultconfæ–‡ä»¶">ä¸‰ã€ä¿®æ”¹default.confæ–‡ä»¶</h2>
<p>æœ¬æ–‡é»˜è®¤ä¸ä¿®æ”¹<code>/etc/nginx/nginx.conf</code>ä¸»é…ç½®æ–‡ä»¶ï¼Œåªåœ¨<code>/etc/nginx/conf.d</code>ç›®å½•ä¸‹è¿›è¡Œç›¸å…³æ“ä½œï¼š</p>
<pre><code># é‡å‘½å
mv ./default.conf ./default.conf.bak

# åˆ›å»ºç›®å½•
mkdir html log

# vim site.conf
//ä¸‹é¢æ˜¯é…ç½®æ–‡ä»¶æ ·ä¾‹
server {
	listen 80;
	server_name example.com; # è¿™é‡Œè¾“å…¥ä½ çš„åŸŸå

	location / {
		return 301 https://example.com$request_uri; # å°†httpé‡å®šå‘åˆ°https
	}
}

server {
	listen 443 ssl;
	server_name example.com; # è¿™é‡Œå¡«åŸŸå
	access_log /etc/nginx/conf.d/log/access.log;
	error_log /etc/nginx/conf.d/log/error.logï¼›

	ssl_certificate /etc/nginx/conf.d/cf.crt; #æŠŠè¯ä¹¦å’Œkeyé‡å‘½ååæ”¾åˆ°æ­¤ç›®å½•ä¸‹
	ssl_certificate_key /etc/nginx/conf.d/cf.key;
	ssl_session_timeout 5m;
	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
	ssl_prefer_server_ciphers on;
	ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4ï¼›

	location / {
		root /etc/nginx/conf.d/html;
		index index.html index.htm;
		autoindex on; # å¼€å¯ç´¢å¼•
		autoindex_exact_size off; # ä¸æ˜¾ç¤ºç¡®åˆ‡å¤§å°
		autoindex_localtime on;
		auth_basic 'Restricted';
		auth_basic_user_file /etc/nginx/conf.d/httppasswd;# è¿™é‡ŒæŒ‡å®šä¸Šé¢ä¸€æ­¥ç”Ÿæˆçš„å¯†é’¥æ–‡æœ¬
	}
}
//ä¸Šé¢æ˜¯é…ç½®æ–‡ä»¶æ ·ä¾‹
</code></pre>
<h2 id="å››-åˆ›å»ºå®¹å™¨">å››ã€åˆ›å»ºå®¹å™¨</h2>
<pre><code>vim run_nginx.sh

//ä¸‹é¢æ˜¯æ ·ä¾‹
#!/bin/bash
docker run -d \
	--name nginx \
	--restart always \
	--net host \
	-v /etc/nginx:/etc/nginx \
	nginx:stable
//ä¸Šé¢æ˜¯æ ·ä¾‹

# æ‰§è¡Œæ­¤æ–‡ä»¶ï¼Œæ¯æ¬¡éœ€è¦é‡æ–°å»ºå®¹å™¨ï¼Œæ‰§è¡Œæ­¤å‘½ä»¤å³å¯
bash run_nginx.sh
</code></pre>
<p><strong>å‚è€ƒé“¾æ¥</strong>ï¼š</p>
<ul>
<li><a href="https://blog.csdn.net/as3luyuan123/article/details/14917959" title="OpenSSLå‘½ä»¤---passwd">OpenSSLå‘½ä»¤---passwd</a></li>
<li><a href="https://blog.csdn.net/guang11cheng/article/details/60965294" title="ç”¨nginxæ­å»ºç®€å•çš„æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨">ç”¨nginxæ­å»ºç®€å•çš„æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨</a></li>
</ul>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E8%8E%B7%E5%8F%96etcnginx%E5%8E%8B%E7%BC%A9%E5%8C%85">ä¸€ã€è·å–/etc/nginxå‹ç¼©åŒ…</a></li>
<li><a href="#%E4%BA%8C-%E5%88%9B%E5%BB%BA%E5%AF%86%E9%92%A5%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6">äºŒã€åˆ›å»ºå¯†é’¥æ–‡æœ¬æ–‡ä»¶</a></li>
<li><a href="#%E4%B8%89-%E4%BF%AE%E6%94%B9defaultconf%E6%96%87%E4%BB%B6">ä¸‰ã€ä¿®æ”¹default.confæ–‡ä»¶</a></li>
<li><a href="#%E5%9B%9B-%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8">å››ã€åˆ›å»ºå®¹å™¨</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://diss.one/youtube-premium-ding-yue-zhi-nan-zui-bian-yi-mei-yue-zhi-yao-2-yuan/">
              <h3 class="post-title">
                YouTube Premium è®¢é˜…æŒ‡å—ï¼Œæœ€ä¾¿å®œæ¯æœˆåªè¦2å…ƒğŸ’°
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://diss.one" target="_blank"> è¡¨é…±ç´« </a>
  <a class="rss" href="https://diss.one/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
